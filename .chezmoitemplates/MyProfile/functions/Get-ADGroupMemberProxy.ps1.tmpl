<#
.SYNOPSIS
Helper `Get-ADGroupMember` proxy

.DESCRIPTION
Helper `Get-ADGroupMember` proxy for default filter parameters and formatter.

.EXAMPLE
Get-ADGroupMember -Name Group
Gets the group members for a group called `Group`

.NOTES
#>
function Get-ADGroupMemberProxy {
    [CmdletBinding(HelpUri = 'http://go.microsoft.com/fwlink/?LinkId=219308')]
    [Alias('gadgm')]
    param()


    dynamicparam {
        try {
            $targetCmd = $ExecutionContext.InvokeCommand.GetCommand('ActiveDirectory\Get-ADGroupMember', [System.Management.Automation.CommandTypes]::Cmdlet, $PSBoundParameters)
            $dynamicParams = @($targetCmd.Parameters.GetEnumerator() | Microsoft.PowerShell.Core\Where-Object { $_.Value.IsDynamic })
            if ($dynamicParams.Length -gt 0) {
                $paramDictionary = [Management.Automation.RuntimeDefinedParameterDictionary]::new()
                foreach ($param in $dynamicParams) {
                    $param = $param.Value

                    if (-not $MyInvocation.MyCommand.Parameters.ContainsKey($param.Name)) {
                        $dynParam = [Management.Automation.RuntimeDefinedParameter]::new($param.Name, $param.ParameterType, $param.Attributes)
                        $paramDictionary.Add($param.Name, $dynParam)
                    }
                }

                return $paramDictionary
            }
        }
        catch {
            throw
        }
    }

    begin {
        try {
            $outBuffer = $null
            if ($PSBoundParameters.TryGetValue('OutBuffer', [ref]$outBuffer)) {
                $PSBoundParameters['OutBuffer'] = 1
            }

            $wrappedCmd = $ExecutionContext.InvokeCommand.GetCommand('ActiveDirectory\Get-ADGroupMember', [System.Management.Automation.CommandTypes]::Cmdlet)
            $scriptCmd = { & $wrappedCmd @PSBoundParameters }

            $steppablePipeline = $scriptCmd.GetSteppablePipeline($MyInvocation.CommandOrigin)
            $steppablePipeline.Begin($MyInvocation.ExpectingInput) # We want output from `.Process` in this block so not using default `$PSCmdlet` parameter
        }
        catch {
            throw
        }
    }

    process {
        try {
            # ActiveDirectory objects are able to make there own properties so `Add-Member` and the like fail.
            $currentIdentity = $PSBoundParameters['Identity']
            $currentADGroupName = $null
            if ($null -ne $currentIdentity.Name ) {
                $currentADGroupName = $currentIdentity.Name
            }
            else {
                # -Identity Parameter implicitly casts to empty ADGroup object
                $currentADGroupName = $currentIdentity.ToString()
                $currentTrySplitDNName = $null
                $currentTrySplitDNName = Split-ADDistinguishedName -DistinguishedName $currentADGroupName -Leaf
                if ($currentTrySplitDNName) {
                    $currentADGroupName = $currentTrySplitDNName
                }
            }
            $steppablePipeline.Process($_) | & { 
                process {
                    $adGroupNoteProperty = [psnoteproperty]::new( 'ADGroup', $currentADGroupName)
                    $_.psobject.properties.Add($adGroupNoteProperty)
                    $_
                }
            }
        }
        catch {
            throw
        }
    }

    end {
        try {
            $steppablePipeline.End()
        }
        catch {
            throw
        }
    }

{{ if eq .isPSCore true }}
    clean
    {
        if ($null -ne $steppablePipeline) {
            $steppablePipeline.Clean()
        }
    }
{{ end }}
}
